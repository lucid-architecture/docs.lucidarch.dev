<!doctype html><html>
<head>
<title>
Database :: Lucid
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name=revised content="2022-02-12T10:53:49 UTC">
<meta name=description content>
<title>Database :: Lucid</title>
<link rel="shortcut icon" href=/images/favicon.png type=image/x-icon>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css>
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/layout.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/css/style.main.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/css/style.menu.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/notice.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/tabs.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/panel.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/columns.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/children.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/attachments.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/alert.css>
<link rel=stylesheet type=text/css href=/css/docport.css>
<script src=/js/docport.js></script>
<script type=text/javascript>var baseurl="https://docs.lucidarch.dev"</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-96232175-1','auto'),ga('send','pageview'))</script><link rel=stylesheet href=/css/custom.css>
<link rel=stylesheet href=/css/syntax.css>
<link rel=apple-touch-icon sizes=180x180 href=/icon/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/icon/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/icon/favicon-16x16.png>
<link rel=manifest href=/icon/site.webmanifest>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body data-url=/database/ class=hideheader>
<style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style>
<article>
<aside>
<div class=search>
<div class=searchbox>
<input data-search-input id=search-by type=text placeholder="Type to search...">
</div>
<script type=text/javascript src=/vendor/lunr/lunr.min.js></script>
<script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script>
<link href=/vendor/auto-complete/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://docs.lucidarch.dev"</script>
<script type=text/javascript src=/js/search.js></script>
</div>
<div style=margin-top:30px>
<a href=/concept style=display:flex;justify-content:left;align-items:center>
<img src=/icon/logo.png width=250 style=margin-left:10px>
</a>
</div>
<div id=close_menu>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">
<i class="fa fa-lg fa-times"></i>
</a>
</div>
<ul class=menu>
<li data-nav-id=https://docs.lucidarch.dev/concept/ class="dd-item
item_level_$level">
<a href=/concept/>Concept</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/philosophy/ class="dd-item
item_level_$level">
<a href=/philosophy/>Philosophy</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/principles/ class="dd-item
item_level_$level">
<a href=/principles/>Principles</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/installation/ class="dd-item
item_level_$level">
<a href=/installation/>Installation</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/upgrade-guide/ class="dd-item alwaysopen
item_level_$level">
<a href=/upgrade-guide/>Upgrade Guide</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/contribution-guide/ class="dd-item
item_level_$level">
<a href=/contribution-guide/>Contribution Guide</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/getting-started/ class="dd-item alwaysopen
item_level_$level">
<a href=/getting-started/>Getting Started</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/micro-vs-monolith/ class="dd-item
item_level_$level">
<a href=/micro-vs-monolith/>Micro • Monolith</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/routing/ class="dd-item
item_level_$level">
<a href=/routing/>Routing</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/controllers/ class="dd-item
item_level_$level">
<a href=/controllers/>Controllers</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/features/ class="dd-item
item_level_$level">
<a href=/features/>Features</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/jobs/ class="dd-item
item_level_$level">
<a href=/jobs/>Jobs</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/operations/ class="dd-item
item_level_$level">
<a href=/operations/>Operations</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/services/ class="dd-item
item_level_$level">
<a href=/services/>Services</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/domains/ class="dd-item
item_level_$level">
<a href=/domains/>Domains</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/testing/ class="dd-item
item_level_$level">
<a href=/testing/>Testing</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/database/ class="dd-item parent active
item_level_$level">
<a href=/database/>Database</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/validation/ class="dd-item
item_level_$level">
<a href=/validation/>Validation</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/cli/ class="dd-item
item_level_$level">
<a href=/cli/>CLI Reference</a>
</li>
</ul>
</aside>
<section class=page>
<nav id=ariane aria-label=breadcrumb>
<ol class=ariane>
<li>
<a class=text-link href=https://docs.lucidarch.dev>
Home
</a>
</li>
<li class=active>
Database
</li>
</ol>
</nav>
<h1>Database</h1>
<div class=jump-to-section>
<span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})">
<span class="fas fa-align-right"></span>
Jump to Section
<i class="fas fa-chevron-right"></i>
</span>
<nav id=TableOfContents>
<ul>
<li><a href=#migrations>Migrations</a>
<ul>
<li><a href=#generate-service-migration>Generate Service Migration</a></li>
<li><a href=#run-service-migrations>Run Service Migrations</a></li>
<li><a href=#disable-service-migrations>Disable Service Migrations</a></li>
</ul>
</li>
<li><a href=#factories>Factories</a></li>
<li><a href=#seeders>Seeders</a></li>
</ul>
</nav>
</div>
<div class=content>
<h2 ref=migrations>Migrations</h2><a class=anchor id=migrations></a>
<ul>
<li>
<p>Micro migrations: Are the Laravel built-in migrations so please refer to the <a href=https://laravel.com/docs/migrations>official docs</a> and the <code>artisan migrate:*</code> commands.</p>
</li>
<li>
<p>Service migrations: When a service is generated with the <code>lucid make:service</code> command, it will contain a <code>database</code> directory that resemble <code>/database</code> at root.</p>
</li>
</ul>
<pre tabindex=0><code>app/Services/Chat/database
├── factories
├── migrations
└── seeders
</code></pre>
<div class="notices info">
<p><i class="fas fa-info-circle"></i> The examples in this document assume that our service name is <code>Chat</code>, please make sure to replace it with your service name instead.</p>
</div>
<h3 ref=generate-service-migration>Generate Service Migration</h3><a class=anchor id=generate-service-migration></a>
<p><strong>Signature</strong> <code>lucid make:migration &lt;migration> &lt;service></code></p>
<p><strong>Example</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lucid make:migration create_messages_table chat
</code></pre></div><p>Will generate <code>app/Services/Chat/database/migrations/{date}_create_messages_table.php</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>use</span> <span class=nx>Illuminate\Database\Migrations\Migration</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Database\Schema\Blueprint</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Schema</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>CreateMessagesTable</span> <span class=k>extends</span> <span class=nx>Migration</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * Run the migrations.
</span><span class=sd>     *
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>up</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nx>Schema</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=s1>&#39;messages&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Blueprint</span> <span class=nv>$table</span><span class=p>)</span> <span class=p>{</span>
            <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>();</span>
            <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>timestamps</span><span class=p>();</span>
        <span class=p>});</span>
    <span class=p>}</span>

    <span class=sd>/**
</span><span class=sd>     * Reverse the migrations.
</span><span class=sd>     *
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>down</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nx>Schema</span><span class=o>::</span><span class=na>dropIfExists</span><span class=p>(</span><span class=s1>&#39;messages&#39;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 ref=run-service-migrations>Run Service Migrations</h3><a class=anchor id=run-service-migrations></a>
<p>Our migrations are recognized by Laravel due to them being loaded automatically in the service provider - <code>ChatServiceProvider</code> in this example.</p>
<p>Which makes it straight-forward to run them:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>php artisan migrate
</code></pre></div><h3 ref=disable-service-migrations>Disable Service Migrations</h3><a class=anchor id=disable-service-migrations></a>
<p>If your service doesn&rsquo;t use a [separate] database (you may always still use Laravel&rsquo;s default migrations) and you wish to clean it up from database stuff:</p>
<ul>
<li>Remove <code>app/Services/Chat/database</code> directory</li>
<li>Remove the following snippet from <code>ChatServiceProvider::boot</code> in <code>app/Services/Chat/Providers/ChatServiceProvider.php</code>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>loadMigrationsFrom</span><span class=p>([</span>
    <span class=nx>realpath</span><span class=p>(</span><span class=no>__DIR__</span> <span class=o>.</span> <span class=s1>&#39;/../database/migrations&#39;</span><span class=p>)</span>
<span class=p>]);</span>
</code></pre></div></li>
</ul>
<h2 ref=factories>Factories</h2><a class=anchor id=factories></a>
<ol>
<li>
<p>Register service factories in composer</p>
<ul>
<li>Under <code>autoload.psr-4</code> add</li>
</ul>
<p><code>"App\\Services\\Chat\\Database\\Factories\\": "app/Services/Chat/database/factories/"</code></p>
<p>So your <code>composer.json</code> should have a similar section as this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;autoload&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;psr-4&#34;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;App\\&#34;</span><span class=p>:</span> <span class=s2>&#34;app/&#34;</span><span class=p>,</span>
            <span class=nt>&#34;Database\\Factories\\&#34;</span><span class=p>:</span> <span class=s2>&#34;database/factories/&#34;</span><span class=p>,</span>
            <span class=nt>&#34;Database\\Seeders\\&#34;</span><span class=p>:</span> <span class=s2>&#34;database/seeders/&#34;</span><span class=p>,</span>
            <span class=nt>&#34;App\\Services\\Chat\\Database\\Factories\\&#34;</span><span class=p>:</span> <span class=s2>&#34;app/Services/Chat/database/factories/&#34;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><ul>
<li>Run <code>composer dump-autoload</code></li>
</ul>
</li>
<li>
<p>Create factory class (e.g. <code>php artisan make:factory --model=Message</code>)</p>
</li>
<li>
<p>Move factory class from <code>/database/factories</code> to <code>/app/Services/Chat/database/factories</code></p>
</li>
<li>
<p>Change class namespace to <code>App\Services\Chat\Database\Factories</code></p>
</li>
<li>
<p>In your model class (here it&rsquo;s <code>Message</code>): add <code>newFactory()</code> method. This is a method override that Laravel natively looks at before loading the default factory (see <code>HasFactory</code> trait)</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Chat\Database\Factories\MessageFactory</span><span class=p>;</span>

<span class=k>protected</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>newFactory</span><span class=p>()</span>
<span class=p>{</span>
    <span class=k>return</span> <span class=nx>app</span><span class=p>(</span><span class=nx>MessageFactory</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></li>
<li>
<p>Use the factory from the model as you would by default: <code>Message::factory()->make()</code></p>
</li>
</ol>
<h2 ref=seeders>Seeders</h2><a class=anchor id=seeders></a>
<ol>
<li>
<p>Register service seeders in composer</p>
<ul>
<li>Under <code>autoload.psr-4</code> add the following</li>
</ul>
<p><code>"App\\Services\\Chat\\Database\\Seeders\\": "app/Services/Chat/database/seeders/"</code></p>
<p>So your <code>composer.json</code> should have a similar section as this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;autoload&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;psr-4&#34;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&#34;App\\&#34;</span><span class=p>:</span> <span class=s2>&#34;app/&#34;</span><span class=p>,</span>
            <span class=nt>&#34;Database\\Factories\\&#34;</span><span class=p>:</span> <span class=s2>&#34;database/factories/&#34;</span><span class=p>,</span>
            <span class=nt>&#34;Database\\Seeders\\&#34;</span><span class=p>:</span> <span class=s2>&#34;database/seeders/&#34;</span><span class=p>,</span>
            <span class=nt>&#34;App\\Services\\Chat\\Database\\Seeders\\&#34;</span><span class=p>:</span> <span class=s2>&#34;app/Services/Chat/database/seeders/&#34;</span>
        <span class=p>}</span>
    <span class=p>},</span>
<span class=p>}</span>
</code></pre></div><ul>
<li>Run <code>composer dump-autoload</code></li>
</ul>
</li>
<li>
<p>Create seeder class (e.g. <code>php artisan make:seeder MessageSeeder</code>)</p>
</li>
<li>
<p>Move seeder class from <code>/database/seeders</code> to <code>/app/Services/Chat/database/seeders</code></p>
</li>
<li>
<p>Change class namespace to <code>App\Services\Chat\Database\Seeders</code></p>
</li>
<li>
<p>Call <code>MessageSeeder::class</code> from <code>/database/seeders/DatabaseSeeder.php</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Services\Chat\Database\Seeders\MessageSeeder</span><span class=p>;</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>run</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>call</span><span class=p>([</span>
            <span class=nx>MessageSeeder</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
        <span class=p>]);</span>
    <span class=p>}</span>
</code></pre></div></li>
<li>
<p>Seed the database with <code>php artisan db:seed</code></p>
</li>
</ol>
</div>
<div class=chevrons>
<a class=next href=/validation/ title=Validation style=margin-right:0>
<div>
<p>Next page</p>
<label>Validation</label>
</div>
<i class="fas fa-arrow-right" style=font-size:1.7em></i></a>
</div>
</section>
<section class=right-menu>
<div class=TableOfContents>
<label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label>
<nav>
<ul>
<li><a href=/database/>Database</a></li>
</ul>
</nav>
<nav id=TableOfContents>
<ul>
<li><a href=#migrations>Migrations</a>
<ul>
<li><a href=#generate-service-migration>Generate Service Migration</a></li>
<li><a href=#run-service-migrations>Run Service Migrations</a></li>
<li><a href=#disable-service-migrations>Disable Service Migrations</a></li>
</ul>
</li>
<li><a href=#factories>Factories</a></li>
<li><a href=#seeders>Seeders</a></li>
</ul>
</nav>
</div>
<div class=Actions>
<nav>
<ul>
<li>
<i class="fas fa-calendar"></i>
Last update on 12 February 2022
</li>
<li title>
<i class="fas fa-user"></i>
Last update by Abed Halawi
</li>
</ul>
</nav>
</div>
</section>
</article>
<footer>
<div class=columns>
<div class=column>
<div style=font-family:Raleway!important>
<h3 style=color:#fdfdfd!important>lucid architecture</h3>
for a scalable future software
</div>
</div>
<div class=column>
<div style=display:flex;justify-content:flex-end;align-items:center>
<div style=align-items:center;display:flex>
<a href=https://lucidarch.dev target=_blank><img src=/icon/lucid-coloured.png alt="Lucid website link" width=28px style=margin-top:4px></a>
<a href=https://github.com/lucidarch target=_blank style=margin-left:10px><i class="fab fa-github fa-lg"></i></a>
<a href=https://lucid-slack.herokuapp.com target=_blank style=margin-left:10px><i class="fab fa-slack fa-lg"></i></a>
<a href=https://www.reddit.com/r/lucidarch target=_blank style=margin-left:10px><i class="fab fa-reddit-alien fa-lg"></i></a>
</div>
<div style=margin-left:50px;margin-top:6px>
<a class=github-button href=https://github.com/sponsors/lucidarch data-icon=octicon-heart aria-label="Sponsor @lucidarch on GitHub">Sponsor</a>
<a class=github-button href=https://github.com/lucidarch/lucid data-icon=octicon-star data-show-count=true aria-label="Star lucidarch/lucid on GitHub">Star</a>
</div>
</div>
</div>
</div>
</footer>
</body>
</html>