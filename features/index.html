<!doctype html><html>
<head>
<title>
Features :: Lucid
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name=revised content="2022-02-12T10:53:49 UTC">
<meta name=description content>
<title>Features :: Lucid</title>
<link rel="shortcut icon" href=/images/favicon.png type=image/x-icon>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css>
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/layout.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/css/style.main.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/css/style.menu.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/notice.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/tabs.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/panel.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/columns.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/children.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/attachments.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/alert.css>
<link rel=stylesheet type=text/css href=/css/docport.css>
<script src=/js/docport.js></script>
<script type=text/javascript>var baseurl="https://docs.lucidarch.dev"</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-96232175-1','auto'),ga('send','pageview'))</script><link rel=stylesheet href=/css/custom.css>
<link rel=stylesheet href=/css/syntax.css>
<link rel=apple-touch-icon sizes=180x180 href=/icon/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/icon/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/icon/favicon-16x16.png>
<link rel=manifest href=/icon/site.webmanifest>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body data-url=/features/ class=hideheader>
<style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style>
<article>
<aside>
<div class=search>
<div class=searchbox>
<input data-search-input id=search-by type=text placeholder="Type to search...">
</div>
<script type=text/javascript src=/vendor/lunr/lunr.min.js></script>
<script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script>
<link href=/vendor/auto-complete/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://docs.lucidarch.dev"</script>
<script type=text/javascript src=/js/search.js></script>
</div>
<div style=margin-top:30px>
<a href=/concept style=display:flex;justify-content:left;align-items:center>
<img src=/icon/logo.png width=250 style=margin-left:10px>
</a>
</div>
<div id=close_menu>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">
<i class="fa fa-lg fa-times"></i>
</a>
</div>
<ul class=menu>
<li data-nav-id=https://docs.lucidarch.dev/concept/ class="dd-item
item_level_$level">
<a href=/concept/>Concept</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/philosophy/ class="dd-item
item_level_$level">
<a href=/philosophy/>Philosophy</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/principles/ class="dd-item
item_level_$level">
<a href=/principles/>Principles</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/installation/ class="dd-item
item_level_$level">
<a href=/installation/>Installation</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/upgrade-guide/ class="dd-item alwaysopen
item_level_$level">
<a href=/upgrade-guide/>Upgrade Guide</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/contribution-guide/ class="dd-item
item_level_$level">
<a href=/contribution-guide/>Contribution Guide</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/getting-started/ class="dd-item alwaysopen
item_level_$level">
<a href=/getting-started/>Getting Started</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/micro-vs-monolith/ class="dd-item
item_level_$level">
<a href=/micro-vs-monolith/>Micro â€¢ Monolith</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/routing/ class="dd-item
item_level_$level">
<a href=/routing/>Routing</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/controllers/ class="dd-item
item_level_$level">
<a href=/controllers/>Controllers</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/features/ class="dd-item parent active
item_level_$level">
<a href=/features/>Features</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/jobs/ class="dd-item
item_level_$level">
<a href=/jobs/>Jobs</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/operations/ class="dd-item
item_level_$level">
<a href=/operations/>Operations</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/services/ class="dd-item
item_level_$level">
<a href=/services/>Services</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/domains/ class="dd-item
item_level_$level">
<a href=/domains/>Domains</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/testing/ class="dd-item
item_level_$level">
<a href=/testing/>Testing</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/database/ class="dd-item
item_level_$level">
<a href=/database/>Database</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/validation/ class="dd-item
item_level_$level">
<a href=/validation/>Validation</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/cli/ class="dd-item
item_level_$level">
<a href=/cli/>CLI Reference</a>
</li>
</ul>
</aside>
<section class=page>
<nav id=ariane aria-label=breadcrumb>
<ol class=ariane>
<li>
<a class=text-link href=https://docs.lucidarch.dev>
Home
</a>
</li>
<li class=active>
Features
</li>
</ol>
</nav>
<h1>Features</h1>
<div class=jump-to-section>
<span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})">
<span class="fas fa-align-right"></span>
Jump to Section
<i class="fas fa-chevron-right"></i>
</span>
<nav id=TableOfContents>
<ul>
<li><a href=#generate-feature-class>Generate Feature Class</a></li>
<li><a href=#inside-features>Inside Features</a></li>
<li><a href=#the-handle-method>The <code>handle</code> method</a></li>
<li><a href=#serving-features>Serving Features</a>
<ul>
<li><a href=#http>HTTP</a></li>
<li><a href=#command>Command</a></li>
<li><a href=#other>Other</a></li>
</ul>
</li>
<li><a href=#testing>Testing</a>
<ul>
<li><a href=#mocking>Mocking</a></li>
</ul>
</li>
<li><a href=#faq>FAQ</a></li>
</ul>
</nav>
</div>
<div class=content>
<p>Represents a human-readable app feature in a class, named the way you would describe it to your colleagues and clients.
It contains the logic of implementing the feature with minimum friction and level of detail to remain concise and straight to the point.</p>
<p>It runs Lucid Units: <em>Jobs</em> and <em>Operations</em> to perform its tasks. They are thought of as the steps in the process of serving its purpose. A <em>Feature</em> can be served from anywhere, most commonly Controllers and Commands. Can also be queued to run asynchronously using Laravel&rsquo;s powerful <a href=https://laravel.com/docs/queues>Queueing capabilities</a>.</p>
<hr>
<p><strong>Technically</strong>, it is a class that encapsulates all the functionalities required for a single request/response lifecycle (or command), in which the <code>handle</code> method represents the task list when you want to implement it in your application.</p>
<p><strong>Example:</strong> This is how a Feature class typically looks like. <em>(simplified)</em></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UpdateProductFeature</span> <span class=k>extends</span> <span class=nx>Feature</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$id</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>id</span> <span class=o>=</span> <span class=nv>$id</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>ValidateProductInputJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>());</span>

        <span class=nv>$product</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>SaveProductJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>,</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span>
            <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>),</span>
        <span class=p>]);</span>

        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>RespondWithJsonJob</span><span class=p>(</span><span class=nv>$product</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div>
<div class="notices info">
<p><i class="fas fa-info-circle"></i>Â Running Lucid Units asynchronously is as simple as having them implement the <code>Queueable</code> interface, applies to all of
units such as <em>Jobs</em> and <em>Operations</em> and <em>Features</em>.</p>
</div>
<figure><img src=/media/images/feature/controller-feature.png alt="Lucid Feature Definition" width=600px>
</figure>
<p><strong>Responsibility:</strong> Perform the steps required to accomplish the feature by running <em>Jobs</em> and <em>Operations</em>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UserController</span> <span class=k>extends</span> <span class=nx>Controller</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>login</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>serve</span><span class=p>(</span><span class=nx>LoginUserFeature</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 ref=generate-feature-class>Generate Feature Class</h2><a class=anchor id=generate-feature-class></a>
<p>Use <code>lucid</code> CLI to generate a Feature class that extends Lucid&rsquo;s Feature base class by default, which allows us to run jobs and operations using the built-in <code>run</code> method.</p>
<div class=tabs><input type=radio name=tabs-2 id=tabs-2-0 checked>
<label for=tabs-2-0>Micro</label>
<div class=tab><p><strong>Signature</strong> <code>lucid make:feature &lt;feature></code></p>
<p><strong>Example</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash> lucid make:feature ListProducts
</code></pre></div><p>Generated class will be at <code>app/Features/ListProductsFeatures.php</code></p>
<p>and its test at <code>tests/Feature/ListProductsFeaturesTest.php</code></p>
</div><input type=radio name=tabs-2 id=tabs-2-1>
<label for=tabs-2-1>Monolith</label>
<div class=tab><p><strong>Signature</strong> <code>lucid make:feature &lt;feature> &lt;service></code></p>
<p><strong>Example</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash> lucid make:feature ListProducts Commerce
</code></pre></div><p>Generated class will be at <code>app/Services/Commerce/Features/ListProductsFeatures.php</code></p>
<p>and its test at <code>tests/Feature/Services/Commerce/ListProductsFeaturesTest.php</code></p>
</div></div>
<p>The generated Feature class will automatically be suffixed with <code>Feature</code>, so the
class above will be <code>ListProductsFeature</code>.</p>
<p>Features can also be generated in subdirectories by specifying their paths</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash> lucid make:feature Thread/AddThread Forum
</code></pre></div><p>Generated class will be at <code>app/Services/Forum/Features/Thread/AddThreadFeature.php</code></p>
<div class="notices info">
<p><i class="fas fa-asterisk"></i>Â For more details on this command see the help manual with <code>lucid make:feature --help</code></p>
</div>
<h2 ref=inside-features>Inside Features</h2><a class=anchor id=inside-features></a>
<p>There are two essential highlights in a feature:</p>
<ol>
<li>Signature (a.k.a constructor parameters): Looking at the signature of the <em>Feature</em> should give the idea of what is required for it to be served.</li>
<li><code>handle</code> method: Looking at the class&rsquo;s <code>handle</code> method should provide an overview of the steps required to serve the feature to the user (or any consuming party) without having to know too much details about the inner workings of each step. More on this at <a href=#the-handle-method>below</a>.</li>
</ol>
<figure><img src=/media/images/feature/controller-feature-expanded.png alt="Lucid Feature Expanded" width=1000px>
</figure>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>CreateArticleFeature</span> <span class=k>extends</span> <span class=nx>Feature</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>ValidateArticleInputJob</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>()));</span>

        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>UploadFilesToCDNJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;files&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;files&#39;</span><span class=p>)]);</span>

        <span class=nv>$slug</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>GenerateSlugJob</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>)));</span>

        <span class=nv>$article</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>SaveArticleJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
            <span class=p>[</span>
                <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span>
                <span class=s1>&#39;body&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;body&#39;</span><span class=p>),</span>
                <span class=s1>&#39;slug&#39;</span> <span class=o>=&gt;</span> <span class=nv>$slug</span><span class=p>,</span>
            <span class=p>]</span>
        <span class=p>);</span>

        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>RespondWithJsonJob</span><span class=p>(</span><span class=nv>$article</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>As shown in the example above, there are several ways to run Jobs in features that are explained in details in the definition of <em>Jobs</em>.</p>
<div class=card><div class=card-body>
<p class=card-text><p><i class="fas fa-bolt"></i> It is recommended to always specify the required parameters in each unit&rsquo;s constructor rather than hiding them within
the unit. i.e. pass each input parameter separately rather than the entire <code>$request->input()</code>, or relying
on the unit to inject <code>Request</code> class. This way we keep it clear to know what is required for a job or operation to do its work.</p>
</p>
</div></div>
<h2 ref=the-handle-method>The <code>handle</code> method</h2><a class=anchor id=the-handle-method></a>
<p>Lucid units (Feature, Job, Operation) are simply classes extending Laravel&rsquo;s base Job class with extra functionality that ties them together. Hence, the use of <code>handle</code> method as the invocation point for each of these units.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
</code></pre></div><p>This method is called automatically when running <code>$this->serve(Feature::class)</code> and it goes through Laravel&rsquo;s IoC to resolve dependencies. In this example we included the <code>Request</code> class to be resolved so that we can access it and pass input to <em>Jobs</em>. <code>Request</code> could&rsquo;ve been any other class in the application that can be resolved using IoC.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>MyCustomClass</span> <span class=nv>$mcc</span><span class=p>)</span>
</code></pre></div><p>This is the recommended way of using classes to maintain testability by interchanging class instances with their mocks.</p>
<div class="notices info">
<p><i class="fas fa-info-circle"></i>Â <code>handle</code> is the same for all Lucid units: <em>Feature, Job</em> and <em>Operation</em> and it behaves the same everywhere.</p>
</div>
<h2 ref=serving-features>Serving Features</h2><a class=anchor id=serving-features></a>
<p>You may serve features from anywhere in your application! Here are some exapmles of doing so.</p>
<h3 ref=http>HTTP</h3><a class=anchor id=http></a>
<p>If your controller is generated through the <code>lucid</code> command, all you need to do is call <code>serve</code> within the controller method,
otherwise, have your controller (or parent controller) extend Lucid&rsquo;s controller <code>Lucid\Units\Controller</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>Lucid\Units\Controller</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Features\UpdateProductsFeature</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>ProductController</span> <span class=k>extends</span> <span class=nx>Controller</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>products</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>serve</span><span class=p>(</span><span class=nx>ListProductsFeature</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 ref=command>Command</h3><a class=anchor id=command></a>
<p>To run a feature from the command we just need to equip our Command class with Lucid&rsquo;s methods by simply using <code>ServesFeatures</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>Illuminate\Console\Command</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Features\CleanStaleCartsFeature</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Lucid\Bus\ServesFeatures</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>CleanStaleCarts</span> <span class=k>extends</span> <span class=nx>Command</span>
<span class=p>{</span>
    <span class=k>use</span> <span class=nx>ServesFeatures</span><span class=p>;</span>

    <span class=k>protected</span> <span class=nv>$signature</span> <span class=o>=</span> <span class=s1>&#39;clean:carts --stale&#39;</span><span class=p>;</span>

    <span class=k>protected</span> <span class=nv>$description</span> <span class=o>=</span> <span class=s2>&#34;Cleans inactive customer carts.&#34;</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>serve</span><span class=p>(</span><span class=nx>CleanStaleCartsFeature</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><h3 ref=other>Other</h3><a class=anchor id=other></a>
<p>Just like we did for <a href=#command>Commands</a> we may do the same in any class we want, by simply using <code>ServesFeatures</code>
the <code>serve</code> method will be available.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>use</span> <span class=nx>App\Features\DoSomethingFeature</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Lucid\Bus\ServesFeatures</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>ToServeFeaturesHere</span>
<span class=p>{</span>
    <span class=k>use</span> <span class=nx>ServesFeatures</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>give</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>serve</span><span class=p>(</span><span class=nx>GiveHighFiveFeature</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 ref=testing>Testing</h2><a class=anchor id=testing></a>
<p>When generating a feature with <code>lucid make:feature</code> a test class is automatically generated along, having <code>markIncomplete()</code> statement
in a stub method as a reminder to fill the missing test.</p>
<div class=tabs><input type=radio name=tabs-7 id=tabs-7-0 checked>
<label for=tabs-7-0>Micro</label>
<div class=tab><p><code>lucid make:feature ListProductsFeature</code></p>
<p>Would generate two files:</p>
<ul>
<li><code>app/Features/ListProductsFeature</code></li>
<li><code>tests/Feature/ListProductsFeatureTest</code></li>
</ul>
</div><input type=radio name=tabs-7 id=tabs-7-1>
<label for=tabs-7-1>Monolith</label>
<div class=tab><p><code>lucid make:feature ListProductsFeature api</code></p>
<p>Would generate two files:</p>
<ul>
<li><code>app/Services/Api/Features/ListProductsFeature</code></li>
<li><code>tests/Feature/Services/Api/ListProductsFeatureTest</code></li>
</ul>
<p>Since Monolith is about scope and distribution of responsibility, and features are a scope of a service,
tests are distributed and scoped accordingly in the corresponding service.</p>
</div></div>
<p>Feature tests are equivalent to functional tests in a typical application. It is about testing how the feature would behave
with a certain input combination from a user&rsquo;s perspective.</p>
<p>If the feature is served over an HTTP request, the test would be about actually requesting the URL and passing parameters
to receive the expected output, in addition to further assertions in the case of storage or other application aspects
that require further assertion.</p>
<div class="notices secondary">
<p>The example below is incomplete and is for illustrative purposes only (e.g. <code>$fake</code> must be defined).</p>
</div>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UpdateProductDetailsFeatureTest</span> <span class=k>extends</span> <span class=nx>TestCase</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>test_successful_product_details_update</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nv>$product</span> <span class=o>=</span> <span class=p>[</span>
            <span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$fake</span><span class=o>-&gt;</span><span class=na>uuid</span><span class=p>,</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$fake</span><span class=o>-&gt;</span><span class=na>sentence</span><span class=p>,</span>
            <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$fake</span><span class=o>-&gt;</span><span class=na>text</span><span class=p>,</span>
            <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$faker</span><span class=o>-&gt;</span><span class=na>randomNumber</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span>
        <span class=p>];</span>

        <span class=c1>// request
</span><span class=c1></span>        <span class=nv>$response</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>put</span><span class=p>(</span><span class=s2>&#34;/products/</span><span class=si>{</span><span class=nv>$product</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$product</span><span class=p>);</span>
        <span class=nv>$response</span><span class=o>-&gt;</span><span class=na>assertStatus</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
                 <span class=o>-&gt;</span><span class=na>assertJson</span><span class=p>([</span>
                    <span class=s1>&#39;updated&#39;</span> <span class=o>=&gt;</span> <span class=k>true</span>
                 <span class=p>]);</span>

        <span class=c1>// storage
</span><span class=c1></span>        <span class=nv>$stored</span> <span class=o>=</span> <span class=nx>Product</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=nv>$production</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]);</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>assertEquals</span><span class=p>(</span><span class=nv>$product</span><span class=p>,</span> <span class=nv>$stored</span><span class=o>-&gt;</span><span class=na>toArray</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>test_failing_product_details_update</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nv>$product</span> <span class=o>=</span> <span class=p>[</span>
            <span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$fake</span><span class=o>-&gt;</span><span class=na>uuid</span><span class=p>,</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=c1>// cannot be empty
</span><span class=c1></span>            <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$fake</span><span class=o>-&gt;</span><span class=na>text</span><span class=p>,</span>
            <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$faker</span><span class=o>-&gt;</span><span class=na>randomNumber</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span>
        <span class=p>];</span>

        <span class=nv>$response</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>put</span><span class=p>(</span><span class=s2>&#34;/products/</span><span class=si>{</span><span class=nv>$product</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=nv>$product</span><span class=p>);</span>
        <span class=nv>$response</span><span class=o>-&gt;</span><span class=na>assertStatus</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
                 <span class=o>-&gt;</span><span class=na>assertJson</span><span class=p>([</span>
                    <span class=s1>&#39;updated&#39;</span> <span class=o>=&gt;</span> <span class=k>false</span><span class=p>,</span>
                    <span class=s1>&#39;error&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
                        <span class=s1>&#39;messages&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;title field is required.&#39;</span><span class=p>],</span>
                    <span class=p>],</span>
                 <span class=p>]);</span>

        <span class=c1>// storage - ensure original title is still in place
</span><span class=c1></span>        <span class=nv>$stored</span> <span class=o>=</span> <span class=nx>Product</span><span class=o>::</span><span class=na>find</span><span class=p>(</span><span class=nv>$production</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]);</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>assertEquals</span><span class=p>(</span><span class=s1>&#39;previous title&#39;</span><span class=p>,</span> <span class=nv>$stored</span><span class=o>-&gt;</span><span class=na>title</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>As far as functional testing goes, it is best to portray the usage of the feature from a broad perspective rather than digging
into every detail of the steps of the function. Feature testing is usually considered to be the integration test between
the units that make up the feature.</p>
<h3 ref=mocking>Mocking</h3><a class=anchor id=mocking></a>
<p>It is recommended with feature tests to only mock what&rsquo;s external to your application to preserve the quality guarantee .
Mocks are usually for 3rd-party APIs and other services that we integrate with, but <strong>not</strong> for internals such as storage.</p>
<p><strong>For this example we will assume that this feature runs from a command line rather than over HTTP.</strong></p>
<div class="notices light">
<p>This example contains missing variables and is for illustrative purposes only.</p>
</div>
<p><code>app/Features/UpdateFacebookPostsFeature.php</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UpdateFacebookPostsFeature</span> <span class=k>extends</span> <span class=nx>Feature</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nv>$posts</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>FetchFacebookPostsJob</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>

        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>StoreFacebookPostsJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;posts&#39;</span> <span class=o>=&gt;</span> <span class=nv>$posts</span><span class=p>,</span>
        <span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p><code>app/Domains/Facebook/Jobs/FetchFacebookPostsJob.php</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>FetchFacebookPostsJob</span> <span class=k>extends</span> <span class=nx>Job</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>FacebookClient</span> <span class=nv>$fb</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$fb</span><span class=o>-&gt;</span><span class=na>posts</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p><code>tests/Feature/UpdateFacebookPostsFeatureTest.php</code></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php>
<span class=k>class</span> <span class=nc>UpdateFacebookPostsFeatureTest</span> <span class=k>extends</span> <span class=nx>TestCase</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>test_successfully_fetching_facebook_posts</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nv>$mFB</span> <span class=o>=</span> <span class=nx>Mockery</span><span class=o>::</span><span class=na>mock</span><span class=p>(</span><span class=nx>FacebookClient</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
        <span class=nv>$mFB</span><span class=o>-&gt;</span><span class=na>shouldReceive</span><span class=p>(</span><span class=s1>&#39;get&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>with</span><span class=p>(</span><span class=nv>$args</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>andReturn</span><span class=p>(</span><span class=nv>$payload</span><span class=p>);</span>

        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>instance</span><span class=p>(</span><span class=nx>FacebookClient</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$mFB</span><span class=p>);</span>

        <span class=nv>$f</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UpdateFacebookPosts</span><span class=p>();</span>
        <span class=nv>$result</span> <span class=o>=</span> <span class=nv>$f</span><span class=o>-&gt;</span><span class=na>handle</span><span class=p>();</span>

        <span class=c1>// 0 in CLI means success!
</span><span class=c1></span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>assertEquals</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nv>$result</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>As shown in <code>FetchFacebookPostsJob</code> the client has been injected, so we had to replace the instance in IoC to load our mocked
instance instead of the real one.</p>
<hr>
<h2 ref=faq>FAQ</h2><a class=anchor id=faq></a>
<div class=card><div class=card-body>
<p class=card-text><h3 ref=what-not-to-do-in-a-feature>What not to do in a feature?</h3><a class=anchor id=what-not-to-do-in-a-feature></a>
<ul>
<li><strong>Complex conditional logic</strong>: The feature passes output from <em>Jobs</em> and <em>Operations</em> but it barely knows anything about what goes on inside them. It only knows the sequence in which they should run and [maybe] some basic logic that is better be avoided and delegated to jobs and operations of possible.</li>
<li><strong>Process output from units</strong>: Parsing and transformation of content is best done in <em>Job</em> or an <em>Operation</em>. The output returned by a these units should always go as-is to the next unit.
The feature doesn&rsquo;t know much about the internals of steps or how they are actually performed. It is only aware of
the sequence of the steps and the requirements of the different units through their signatures.
This guarantees consistency and predictability when reading the feature&rsquo;s code in the <code>handle</code> method and allows anyone new
to the code to skim through quickly and have an idea about the required steps.</li>
<li><strong>Call another Feature:</strong> In order to avoid the <a href=https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming)>Pyramid of Doom</a> and reduce the <a href=https://en.wikiversity.org/wiki/Software_Design/Cognitive_load>cognitive load</a> required to navigate the codebase and understand the code, Features should not call each other. Though the same feature may be called numerous times as long as
it does not add up to the Feature&rsquo;s <a href=https://en.wikiversity.org/wiki/Software_Design/Complexity_(primary_quality)>complexity</a>.</li>
</ul>
</p>
</div></div>
<div class=card><div class=card-body>
<p class=card-text><h3 ref=monolith-what-to-do-about-duplicate-functionality-between-services>[Monolith] What to do about duplicate functionality between services?</h3><a class=anchor id=monolith-what-to-do-about-duplicate-functionality-between-services></a>
<div class="notices dark">
<p>TL;DR It is recommended to have similar features across services than share features between them.
Even if it meant repeating the same sequence of units.</p>
</div>
<p>Since Monolith is all about separation of concerns per service, when dealing with multiple sides of the same application
(e.g. Api, CMS, Web UI, etc.) we&rsquo;d need to deal with their features differently; maybe not at the beginning but eventually
we&rsquo;ll find ourselves dealing with too many options and cramming a lot of confusing parameters in the same feature
because we decided to share it with multiple services. To avoid all this, it is best to create a feature per service
even if it means to repeat the same sequence of units. Below is a brief example to illustrate it.</p>
<p><strong>Shared Feature</strong></p>
<p>Supposing that we decided to move the feature class from <code>app/Services/{service}/Features</code> to a place all services may access
like <code>app/Features/UpdateProductDetailsFeature.php</code> and we&rsquo;d like our Api and Web services to use it.
This feature should serve the response in JSON when in the Api service and return a view when in Web:</p>
<div style=margin-left:23px>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UpdateProductDetailsFeature</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=nv>$isApi</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>bool</span> <span class=nv>$isApi</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>isApi</span> <span class=o>=</span> <span class=nv>$isApi</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>ValidateProductDeatilsInputJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;input&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>()</span>
        <span class=p>]);</span>

        <span class=nv>$product</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>UpdateProductDetailsJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span>
            <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;description&#39;</span><span class=p>),</span>
            <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>),</span>
        <span class=p>]);</span>

        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>isApi</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>RespondWithJsonJob</span><span class=p>(</span><span class=nv>$product</span><span class=p>));</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>RespondWithViewJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;view&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;product&#39;</span><span class=p>,</span>
            <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nx>compact</span><span class=p>(</span><span class=s1>&#39;product&#39;</span><span class=p>),</span>
        <span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div>
<p>This is yet a simple example but if we were to add more conditions to customize the experience further, we&rsquo;d be throwing
plenty of <code>$this->isApi</code> everywhere in our feature. For example: the user reference from the API is a token, while the one
from the Web is an ID retrieved from the session. Here&rsquo;s how it would look like:</p>
<div style=margin-left:23px>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
<span class=p>{</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>ValidateProductDeatilsInputJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
        <span class=s1>&#39;input&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>()</span>
    <span class=p>]);</span>

    <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>isApi</span><span class=p>)</span> <span class=p>{</span>
        <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>GetUserByApiTokenJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;token&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;token&#39;</span><span class=p>),</span>
        <span class=p>]);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>GetUserFromSessionJob</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nv>$product</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>UpdateProductDetailsJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
        <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span>
        <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;description&#39;</span><span class=p>),</span>
        <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>),</span>
        <span class=s1>&#39;user&#39;</span> <span class=o>=&gt;</span> <span class=nv>$user</span><span class=p>,</span>
    <span class=p>]);</span>

    <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>isApi</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>RespondWithJsonJob</span><span class=p>(</span><span class=nv>$product</span><span class=p>));</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>RespondWithViewJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
        <span class=s1>&#39;view&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;product&#39;</span><span class=p>,</span>
        <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nx>compact</span><span class=p>(</span><span class=s1>&#39;product&#39;</span><span class=p>),</span>
    <span class=p>]);</span>
<span class=p>}</span>
</code></pre></div></div>
<p>Ugly, isn&rsquo;t it? See the other example for a cleaner approach below.</p>
<p><strong>Feature per Service</strong></p>
<p><code>Api::UpdateProductDetailsFeature</code></p>
<p>located at <code>app/Services/Api/Features/UpdateProductDetailsFeature.php</code></p>
<div style=margin-left:23px>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UpdateProductDetailsFeature</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>ValidateProductDeatilsInputJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;input&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>()</span>
        <span class=p>]);</span>

        <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>GetUserByApiTokenJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;token&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;token&#39;</span><span class=p>),</span>
        <span class=p>]);</span>

        <span class=nv>$product</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>UpdateProductDetailsJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span>
            <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;description&#39;</span><span class=p>),</span>
            <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>),</span>
            <span class=s1>&#39;user&#39;</span> <span class=o>=&gt;</span> <span class=nv>$user</span><span class=p>,</span>
        <span class=p>]);</span>

        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>RespondWithViewJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nx>compact</span><span class=p>(</span><span class=s1>&#39;product&#39;</span><span class=p>),</span>
            <span class=s1>&#39;view&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;web.product.update&#39;</span><span class=p>,</span>
        <span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div>
<p><code>Web::UpdateProductDetailsFeature</code></p>
<p>located at <code>app/Services/Web/Features/UpdateProductDetailsFeature.php</code></p>
<div style=margin-left:23px>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>UpdateProductDetailsFeature</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>ValidateProductDeatilsInputJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;input&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>()</span>
        <span class=p>]);</span>
        
        <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>GetUserFromSessionJob</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>

        <span class=nv>$product</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>UpdateProductDetailsJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>),</span>
            <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;description&#39;</span><span class=p>),</span>
            <span class=s1>&#39;price&#39;</span> <span class=o>=&gt;</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>input</span><span class=p>(</span><span class=s1>&#39;price&#39;</span><span class=p>),</span>
            <span class=s1>&#39;user&#39;</span> <span class=o>=&gt;</span> <span class=nv>$user</span><span class=p>,</span>
        <span class=p>]);</span>

        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>RespondWithViewJob</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>&#39;view&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;product&#39;</span><span class=p>,</span>
            <span class=s1>&#39;data&#39;</span> <span class=o>=&gt;</span> <span class=nx>compact</span><span class=p>(</span><span class=s1>&#39;product&#39;</span><span class=p>),</span>
        <span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div>
</p>
</div></div>
</div>
<div class=chevrons>
<a class=next href=/jobs/ title=Jobs style=margin-right:0>
<div>
<p>Next page</p>
<label>Jobs</label>
</div>
<i class="fas fa-arrow-right" style=font-size:1.7em></i></a>
</div>
</section>
<section class=right-menu>
<div class=TableOfContents>
<label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label>
<nav>
<ul>
<li><a href=/features/>Features</a></li>
</ul>
</nav>
<nav id=TableOfContents>
<ul>
<li><a href=#generate-feature-class>Generate Feature Class</a></li>
<li><a href=#inside-features>Inside Features</a></li>
<li><a href=#the-handle-method>The <code>handle</code> method</a></li>
<li><a href=#serving-features>Serving Features</a>
<ul>
<li><a href=#http>HTTP</a></li>
<li><a href=#command>Command</a></li>
<li><a href=#other>Other</a></li>
</ul>
</li>
<li><a href=#testing>Testing</a>
<ul>
<li><a href=#mocking>Mocking</a></li>
</ul>
</li>
<li><a href=#faq>FAQ</a></li>
</ul>
</nav>
</div>
<div class=Actions>
<nav>
<ul>
<li>
<i class="fas fa-calendar"></i>
Last update on 12 February 2022
</li>
<li title>
<i class="fas fa-user"></i>
Last update by Abed Halawi
</li>
</ul>
</nav>
</div>
</section>
</article>
<footer>
<div class=columns>
<div class=column>
<div style=font-family:Raleway!important>
<h3 style=color:#fdfdfd!important>lucid architecture</h3>
for a scalable future software
</div>
</div>
<div class=column>
<div style=display:flex;justify-content:flex-end;align-items:center>
<div style=align-items:center;display:flex>
<a href=https://lucidarch.dev target=_blank><img src=/icon/lucid-coloured.png alt="Lucid website link" width=28px style=margin-top:4px></a>
<a href=https://github.com/lucidarch target=_blank style=margin-left:10px><i class="fab fa-github fa-lg"></i></a>
<a href=https://lucid-slack.herokuapp.com target=_blank style=margin-left:10px><i class="fab fa-slack fa-lg"></i></a>
<a href=https://www.reddit.com/r/lucidarch target=_blank style=margin-left:10px><i class="fab fa-reddit-alien fa-lg"></i></a>
</div>
<div style=margin-left:50px;margin-top:6px>
<a class=github-button href=https://github.com/sponsors/lucidarch data-icon=octicon-heart aria-label="Sponsor @lucidarch on GitHub">Sponsor</a>
<a class=github-button href=https://github.com/lucidarch/lucid data-icon=octicon-star data-show-count=true aria-label="Star lucidarch/lucid on GitHub">Star</a>
</div>
</div>
</div>
</div>
</footer>
</body>
</html>